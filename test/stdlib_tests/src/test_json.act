import json
import testing

def _test_json():
    test_json = [
        r"""{"a":null,"b":[null]}""",
        r"""{"a":true,"b":false}""",
        r"""{"a":"1","b":2,"c":3.1}""",
        r"""{"a":{"b":"1","c":2,"d":[1,2]}}""",
        r"""{"a":[1,2,3]}""",
        r"""{"a":[1.1,2.2,3.3]}""",
        r"""{"a":[[1,2,3],[1,2,3]]}""",
        r"""{"a":[{"b":"1","c":2,"d":[1,2]},{"b":"1","c":2,"d":[1,2]}]}""",
    ]
    for s in test_json:
        #log.debug("Input string", {"json_str": s})
        d = json.decode(s)
        #log.debug("Decoded JSON string to dict", {"dict": d})
        testing.assertNotNone(d, "Failed to decode JSON")
        e = json.encode(d)
        #log.debug("Encoded to JSON", {"encoded": s})
        testing.assertNotNone(e, "Failed to encode to JSON")
        testing.assertEqual(s, e, "Input output via JSON round trip does not match")

def _test_json_list_decode():
    test_arrays = [
        r"""[1,2,3]""",
        r"""[true,false,null]""",
        r"""["a","b","c"]""",
        r"""[[1,2],[3,4]]""",
        r"""[{"a":1},{"b":2}]""",
        r"""["x",null,10,3.14,{"k":"v"},[5]]""",
    ]
    for s in test_arrays:
        l = json.decode_list(s)
        testing.assertNotNone(l, "json.decode_list() returned None")
        e = json.encode_list(l)
        testing.assertNotNone(e, "json.encode_list() returned None")
        testing.assertEqual(s, e, "JSON array roundtrip does not match")

def _test_json_encode_fixed_size_int():
    d = {
        "int": 4,
        "i8": i8(-128),
        "i16": i16(-32768),
        "i32": i32(-2147483648),
        "i64": int(-9223372036854775807-1),
        "u1": u1(1),
        "u8": u8(255),
        "u16": u16(65535),
        "u32": u32(4294967295),
        "u64": u64(18446744073709551615)
    }
    j = json.encode(d)
    testing.assertEqual(
        j,
        r"""{"int":4,"i8":-128,"i16":-32768,"i32":-2147483648,"i64":-9223372036854775808,"u1":1,"u8":255,"u16":65535,"u32":4294967295,"u64":18446744073709551615}"""
    )
